<div class="max-w-3xl mx-auto bg-white shadow-md rounded-lg p-6">
  <h2 class="text-2xl font-bold mb-6 text-gray-800">Create New Visit</h2>

  <form #visitForm="ngForm" class="space-y-6">
    <!-- Patient selector -->
    <div>
      <pos-hs-patient-selector (selectedPatientChange)="onPatientSelected($event)"></pos-hs-patient-selector>
    </div>

    <!-- Doctor selector -->
    <div>
      <pos-hs-doctor-selector (selectedDoctorChange)="onDoctorSelected($event)"></pos-hs-doctor-selector>
    </div>

    <!-- Visit Items -->
    <div>
      <h3 class="text-lg font-semibold text-gray-700 mb-2">Visit Items</h3>
      <div class="flex space-x-3 items-center">
        <select [(ngModel)]="selectedItemId" name="item"
                class="flex-1 rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500">
          <option [ngValue]="null">-- choose item --</option>
          <option *ngFor="let c of catalog" [value]="c.id">
            {{ c.name }} ({{ c.unitPrice | number:'1.2-2' }})
          </option>
        </select>
        <input type="number" [(ngModel)]="qty" name="qty" min="1"
               class="w-24 rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500" />
        <button type="button" (click)="addItem()"
                class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 focus:outline-none">
          Add
        </button>
      </div>
    </div>

    <!-- Items Table -->
    <div *ngIf="items.length" class="overflow-x-auto">
      <table class="min-w-full border border-gray-200 rounded-md mt-4">
        <thead class="bg-gray-100 text-gray-700 text-sm">
          <tr>
            <th class="px-3 py-2 text-left">Item</th>
            <th class="px-3 py-2 text-left">Qty</th>
            <th class="px-3 py-2 text-left">Unit</th>
            <th class="px-3 py-2 text-left">Total</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let it of items; let i = index" class="border-t">
            <td class="px-3 py-2">{{ catalogMap.get(it.catalogItemId)?.name }}</td>
            <td class="px-3 py-2">{{ it.quantity }}</td>
            <td class="px-3 py-2">{{ unitPrice(it) | number:'1.2-2' }}</td>
            <td class="px-3 py-2">{{ rowTotal(it) | number:'1.2-2' }}</td>
            <td class="px-3 py-2">
              <button type="button" (click)="remove(i)"
                      class="text-red-600 hover:text-red-800 font-semibold">
                x
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Discount -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Discount</label>
      <input type="number" [(ngModel)]="discount" name="discount" min="0"
             class="block w-40 rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500" />
    </div>

    <!-- Payment Type -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Payment Type</label>
      <select [(ngModel)]="paymentType" name="paymentType" required
              class="block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500">
        <option value="Cash">Cash</option>
        <option value="Card">Card</option>
        <option value="Transfer">Transfer</option>
        <option value="OnAccount">On Account</option>
      </select>
    </div>

    <!-- Totals -->
    <div class="bg-gray-50 rounded-md p-4 space-y-1">
      <p class="text-sm text-gray-700">Doctor Fee: <span class="font-semibold">{{ doctorFee | number:'1.2-2' }}</span></p>
      <p class="text-sm text-gray-700">Items Subtotal: <span class="font-semibold">{{ subtotal() | number:'1.2-2' }}</span></p>
      <p class="text-sm text-gray-700">Discount: <span class="font-semibold">{{ discount | number:'1.2-2' }}</span></p>
      <h3 class="text-lg font-bold text-gray-900">Total: {{ total() | number:'1.2-2' }}</h3>
    </div>

    <!-- Submit -->
    <button type="button" (click)="submit()" 
            class="w-full py-3 px-4 rounded-lg bg-green-600 text-white font-semibold hover:bg-green-700 focus:outline-none disabled:opacity-50">
      Create Visit
    </button>
  </form>
</div>
